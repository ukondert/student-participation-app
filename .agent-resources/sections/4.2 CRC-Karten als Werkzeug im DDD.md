## 4.2 CRC-Karten als Werkzeug im DDD

In diesem Kapitel schlagen wir eine BrÃ¼cke von den klassischen Erhebungstechniken hin zur strategischen Modellierung im Domain-Driven Design. Wir nehmen die bereits bekannte Methode der CRC-Karten und betrachten sie durch die "DDD-Brille". Dabei entdecken wir, wie dieses einfache Werkzeug uns helfen kann, DomÃ¤nenexperten und Entwickler an einen Tisch zu bringen und eine gemeinsame Sprache â€“ die Ubiquitous Language â€“ zu formen.

### 4.2.1. Einleitung: Warum CRC-Karten im DDD-Kontext?

CRC-Karten (Class, Responsibility, Collaborator) sind eine agile Modellierungstechnik, die bereits in den spÃ¤ten 1980er Jahren von Ward Cunningham und Kent Beck entwickelt wurde. Obwohl sie aus einer Zeit vor dem "offiziellen" Domain-Driven Design stammen, erleben sie im modernen DDD-Kontext eine Renaissance. Der Grund dafÃ¼r ist einfach: CRC-Karten sind ein hervorragendes Werkzeug fÃ¼r die **kollaborative Modellierung** und fÃ¶rdern die **Kommunikation** â€“ zwei Kernpfeiler von DDD.

Im Gegensatz zu starren UML-Diagrammen, die oft von einer Person am Computer erstellt werden, sind CRC-Karten physisch, greifbar und laden zur Interaktion ein. Ein Team kann sich um einen Tisch versammeln, Karten verschieben, Verantwortlichkeiten diskutieren und Szenarien durchspielen. Dieser Prozess hilft dabei:

-   Eine **gemeinsame Sprache (Ubiquitous Language)** zu entwickeln, da Fachexperten und Entwickler gezwungen sind, sich auf Begriffe und deren Bedeutung zu einigen.
-   Die **Dynamik des Systems** zu verstehen, nicht nur seine statische Struktur.
-   **KomplexitÃ¤t frÃ¼hzeitig zu entdecken** und das DomÃ¤nenmodell iterativ zu verfeinern.

CRC-Karten sind somit das perfekte "Low-Tech"-Werkzeug, um die LÃ¼cke zwischen der fachlichen DomÃ¤ne und dem technischen Design zu schlieÃŸen.

### 4.2.2. CRC-Karten im Strategischen Design: Die Landkarte der DomÃ¤ne entdecken

Im strategischen Design geht es darum, das groÃŸe Ganze zu verstehen: die DomÃ¤ne in ihre Teilbereiche (Subdomains) zu zerlegen und deren Grenzen (Bounded Contexts) zu definieren. CRC-Karten kÃ¶nnen hier als exploratives Werkzeug dienen, noch bevor ein formales Modell existiert.

**Workshop-Ansatz:**
1.  **Brainstorming von Kandidaten:** Das Team (Entwickler und Fachexperten) sammelt auf Haftnotizen alle wichtigen Substantive aus den GeschÃ¤ftsprozessen. Das kÃ¶nnen Personen (SchÃ¼ler, Lehrer), Dinge (Buch, Mahnung) oder Prozesse (Ausleihe, Bestellung) sein.
2.  **Erste CRC-Karten erstellen:** FÃ¼r die wichtigsten Kandidaten wird eine CRC-Karte angelegt. Die "Klasse" ist hier noch nicht als technische Klasse zu verstehen, sondern als konzeptionelles "Ding" in der DomÃ¤ne.
3.  **Szenarien durchspielen:** Das Team spielt einen Ã¼bergeordneten GeschÃ¤ftsprozess durch, z.B. "Ein neues Buch wird angeschafft und steht zur Ausleihe bereit".
    -   *Wer ist verantwortlich fÃ¼r die Bestellung?* â†’ Eine `Bestellsystem`-Karte entsteht.
    -   *Wer ist verantwortlich fÃ¼r die Katalogisierung?* â†’ Eine `Katalog`-Karte entsteht.
    -   *Wer ist verantwortlich fÃ¼r die Ausleihe?* â†’ Eine `Ausleihsystem`-Karte entsteht.

**Erkenntnisse aus dem Workshop:**
WÃ¤hrend des Durchspielens wird schnell klar, dass der Begriff "Buch" in den verschiedenen Kontexten unterschiedliche Bedeutungen und Verantwortlichkeiten hat:
-   Auf der `Bestellsystem`-Karte hat "Buch" Attribute wie `Preis` und `Lieferant`.
-   Auf der `Katalog`-Karte hat "Buch" Attribute wie `Titel` und `Autor`.
-   Auf der `Ausleihsystem`-Karte hat "Buch" Attribute wie `Ausleihstatus` und `Standort`.

> <span style="font-size: 1.5em">:mag:</span> **Vom "Card-Clustering" zu Bounded Contexts:** Die CRC-Karten, die bei einem Szenario eng zusammenarbeiten, bilden natÃ¼rliche Cluster. Diese Cluster sind oft die ersten Indikatoren fÃ¼r **Bounded Contexts**. Das Team kann die Karten physisch gruppieren und so die Grenzen der DomÃ¤ne sichtbar machen. Die unterschiedlichen Verantwortlichkeiten auf den "Buch"-Karten in den verschiedenen Clustern machen die Notwendigkeit einer spezifischen **Ubiquitous Language** pro Kontext offensichtlich.

### 4.2.3. CRC-Karten im Taktischen Design: Das Modell verfeinern

Nachdem die Bounded Contexts grob identifiziert sind, werden CRC-Karten genutzt, um das Modell *innerhalb* eines Kontexts zu verfeinern. Hier geht es darum, die Bausteine des taktischen Designs â€“ Aggregate, EntitÃ¤ten und Value Objects â€“ zu konkretisieren.

In Abschnitt 4.1.6 haben wir aus User Stories ein erstes statisches DomÃ¤nenmodell abgeleitet. Nun nutzen wir CRC-Karten, um dieses Modell zu validieren und sein dynamisches Verhalten zu simulieren.

**Workshop-Ansatz:**
1.  **Karten aus dem Modell ableiten:** FÃ¼r jedes im statischen Modell identifizierte Aggregat (`Ausleiher`, `AusleihExemplar`) und jede wichtige EntitÃ¤t (`Ausleihe`) wird eine CRC-Karte erstellt.
2.  **Szenario durchspielen:** Das Team nimmt sich einen konkreten Anwendungsfall vor, z.B. "Ein SchÃ¼ler leiht ein Buch aus" (`handleBuchAusleihen`).

Hier sind die CRC-Karten, die als Ausgangspunkt fÃ¼r den Workshop dienen:

**Karte 1: Der Ausleiher (Aggregate Root)**

![CRC-Karte fÃ¼r die Klasse Ausleiher](./images/crc-card-ausleiher.svg "CRC-Karte fÃ¼r die Klasse Ausleiher")

**Karte 2: Das AusleihExemplar (Aggregate Root)**

![CRC-Karte fÃ¼r die Klasse AusleihExemplar](./images/crc-card-ausleihexemplar.svg "CRC-Karte fÃ¼r die Klasse AusleihExemplar")

**Karte 3: Die Ausleihe (EntitÃ¤t)**

![CRC-Karte fÃ¼r die Klasse Ausleihe](./images/crc-card-ausleihe.svg "CRC-Karte fÃ¼r die Klasse Ausleihe")

3.  **Interaktionen simulieren:**
    -   Der Moderator sagt: "Der `AusleihApplicationService` wird aufgerufen mit `ausleiherId` und `exemplarId`."
    -   "Der Service lÃ¤dt das `AusleihExemplar`-Aggregat. Welche Verantwortung hat das Exemplar?" â†’ Das Team schaut auf die `AusleihExemplar`-Karte und antwortet: "Es muss seinen Status kennen. Wir prÃ¼fen, ob es 'verfÃ¼gbar' ist."
    -   "Gut. Nun lÃ¤dt der Service das `Ausleiher`-Aggregat und ruft `leiheBuchAus` auf. Was passiert auf der `Ausleiher`-Karte?" â†’ Das Team simuliert die Logik: "Die Karte `Ausleiher` prÃ¼ft ihr Ausleihlimit. Wenn ok, erstellt sie eine neue `Ausleihe`-Karte (Kollaborateur!) und fÃ¼gt sie ihrer Liste hinzu."
    -   "Welche Verantwortung hat die neue `Ausleihe`-Karte?" â†’ "Sie berechnet ihr `RÃ¼ckgabedatum`."

**Erkenntnisse aus dem Workshop:**
-   **Validierung der Aggregat-Grenzen:** Das Durchspielen bestÃ¤tigt, dass die GeschÃ¤ftsregel "Ausleihlimit prÃ¼fen" korrekt im `Ausleiher`-Aggregat gekapselt ist.
-   **Aufdecken von notwendigen Interaktionen:** Es wird klar, dass der Application Service die Aggregate orchestrieren muss (zuerst das eine laden, prÃ¼fen, dann das andere aufrufen).
-   **Identifizierung von Value Objects:** Bei der Diskussion Ã¼ber das `RÃ¼ckgabedatum` oder die `Leihfrist` merkt das Team, dass diese keine eigene IdentitÃ¤t brauchen. Sie werden als Attribute oder Value Objects auf den Karten vermerkt.

### 4.2.4. Praktischer Workshop-Ablauf: Von der Karte zur verfeinerten Anforderung

Ein CRC-Karten-Workshop im DDD-Kontext folgt einem strukturierten Ablauf, um vom groben Konzept zu einem validierten Modell und prÃ¤zisen Anforderungen zu gelangen.

**Vorbereitung:**
1.  **Team zusammenstellen:** Entwickler, DomÃ¤nenexperten und ein Moderator.
2.  **Materialien:** GroÃŸer Tisch, viele leere Karteikarten, Stifte.
3.  **Input:** User Stories, Event-Storming-Ergebnisse oder ein erster Entwurf des DomÃ¤nenmodells (wie aus 4.1.6).

**DurchfÃ¼hrung (Walkthrough):**
1.  **Szenario auswÃ¤hlen:** WÃ¤hlen Sie einen wichtigen und reprÃ¤sentativen Anwendungsfall.
2.  **Karten identifizieren und erstellen:** Das Team erstellt die CRC-Karten fÃ¼r die beteiligten Klassen/Aggregate.
3.  **Szenario durchspielen:** Der Moderator fÃ¼hrt durch das Szenario. Ein Teammitglied "spielt" jeweils eine Karte, indem es deren Verantwortlichkeiten vorliest und die Kollaborationen aufruft.
4.  **Diskutieren und verfeinern:** Das Team diskutiert bei jedem Schritt: Ist die Verantwortung hier richtig platziert? Fehlt eine Information? Ist die Kollaboration logisch? Die Karten werden live angepasst.

**Nachbereitung: Transformation zur Anforderung**
Die validierten CRC-Karten sind die perfekte Grundlage fÃ¼r detaillierte Systemanforderungen.

-   **Regel 1: Jede "Responsibility" wird zu einer funktionalen Anforderung.**
    -   *Karte `Ausleiher`, Verantwortung `PrÃ¼ft Ausleihlimit`* â†’ `REQ-006: Das System MUSS sicherstellen, dass ein SchÃ¼ler nicht mehr als 5 BÃ¼cher gleichzeitig ausleihen kann.`
-   **Regel 2: Jeder "Collaborator" beschreibt eine Interaktionsanforderung.**
    -   *Karte `Ausleiher` kollaboriert mit `Ausleihe`* â†’ `REQ-007: Bei einer erfolgreichen Ausleihe MUSS das System ein neues, persistentes Ausleihe-Objekt erstellen, das dem Ausleiher zugeordnet ist.`

> <span style="font-size: 1.5em">ğŸ”§</span> **Praxis-Tipp:** Die physischen Karten sind "Wegwerf-Artefakte". Ihr Wert liegt im Prozess des gemeinsamen Entdeckens. Machen Sie am Ende des Workshops Fotos von den finalen Karten-Layouts. Diese Fotos, zusammen mit den abgeleiteten Anforderungen, dienen als wertvolle Dokumentation fÃ¼r die anschlieÃŸende Implementierung.
